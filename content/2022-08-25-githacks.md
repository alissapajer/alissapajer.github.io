title: git Hacks
tags: computers

### configuration

Start the ssh agent (add this to your `~/.zshrc`, for example):

```bash
eval "$(ssh-agent -s)"
```

Add the following at the head of `~/.gitconfig` in order to specify a git configuration per path. These are called _conditional includes_:

```toml
[includeIf "gitdir:~/path/work/"]
    path = .gitconfig-work
[includeIf "gitdir:~/path/play/"]
    path = .gitconfig-play

```

Contents of `~/.gitconfig-work` or `~/.gitconfig-play`:
```toml
[user]    
    name = A B
    username = ab
    email = ab@e.mail
[core]      
    sshCommand = ssh -i ~/.ssh/id_ed25519-work -F none
```

`-F none` specifies that `ssh` shall not look any files, thus forcing it to use the key specified with `-i`.

### debugging

List the source of each git configuration:

```bash
git config --list --show-origin
```

Unset credential helper:

```bash
git config --global --unset credential.helper
```

Show some in-scope git configurations:

```bash
git config user.email
git config user.username
git config core.sshCommand
```

See the full debugs logs of ssh to determine exactly where it's finding ssh keys:
```bash
ssh -v
```

git uses your ssh key to identify you. Determine which user git is authenticating you as:
```bash
ssh -i ~/.ssh/id_ed25519 -F none -T git@github.com
```

Originally I tried using `-o "IdentitiesOnly=yes" -i ~/.ssh/id_ed25519` but this did not always guarantee that I authenticated with the specified ssh key (there are may places ssh looks). So instead I switchd to the more robust `-F none` option.

For other setups, rather than specifying the exact ssh key, you can set various `IdentityFile` in `~/.ssh/config`. It's reasonable practice to specify the host rather than use a wildcard:
```
Host *
    AddKeysToAgent yes
    UseKeychain yes
    IdentityFile ~/.ssh/id_ed25519-work
    IdentityFile ~/.ssh/id_ed25519-play
```

